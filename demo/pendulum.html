<!DOCTYPE html>
<html lang="en" data-theme="light">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Pendulum</title>
  
  <style>
    :root { --bg-color: #f5f5f5; --text-color: #333333; --accent-color: #667eea; --surface-color: #ffffff; }
    * { box-sizing: border-box; }
    body { font-family: system-ui, -apple-system, sans-serif; max-width: 600px; margin: 0 auto; padding: 1rem; background: var(--bg-color); color: var(--text-color); }
    .applet-container { background: var(--surface-color); border-radius: 12px; padding: 1.5rem; box-shadow: 0 4px 20px rgba(0,0,0,0.1); }
    .applet-title { margin: 0 0 0.5rem 0; font-size: 1.5rem; }
    .applet-subtitle { margin: 0 0 1rem 0; font-size: 0.875rem; color: #666; }
    .simulation-canvas { width: 100%; border-radius: 8px; }
    .controls-section { margin-top: 1rem; padding-top: 1rem; border-top: 1px solid rgba(0,0,0,0.1); }
    .control-group { margin: 1rem 0; }
    .control-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.5rem; }
    .control-label { font-size: 0.875rem; font-weight: 500; }
    .control-value { font-family: monospace; font-weight: bold; color: var(--accent-color); }
    input[type="range"] { width: 100%; height: 8px; -webkit-appearance: none; background: #ddd; border-radius: 4px; outline: none; }
    input[type="range"]::-webkit-slider-thumb { -webkit-appearance: none; width: 20px; height: 20px; background: var(--accent-color); border-radius: 50%; cursor: pointer; }
    .button-row { display: flex; gap: 0.5rem; margin-top: 1rem; }
    .btn { padding: 0.5rem 1rem; background: var(--accent-color); color: white; border: none; border-radius: 6px; cursor: pointer; font-size: 0.875rem; }
    .btn:hover { opacity: 0.9; }
    .btn-secondary { background: #6c757d; }
    .stats-row { display: flex; justify-content: space-between; padding: 0.5rem 0; border-bottom: 1px solid #eee; font-size: 0.875rem; }
    .stats-label { color: #666; }
    .stats-value { font-family: monospace; font-weight: 500; }
  </style>
</head>
<body>
  <div class="applet-container">
    <h1 class="applet-title">Pendulum</h1>
    <p class="applet-subtitle">Generated from Bosatsu</p>
    <canvas id="simulation-canvas" class="simulation-canvas" width="552" height="350"></canvas>
    <div class="controls-section">
      <div class="control-group">
        <div class="control-header"><span class="control-label">Length</span><span class="control-value" id="length-display">200px</span></div>
        <input type="range" id="length-slider" min="50" max="250" value="200">
      </div>
      <div class="control-group">
        <div class="control-header"><span class="control-label">Gravity</span><span class="control-value" id="gravity-display">10</span></div>
        <input type="range" id="gravity-slider" min="1" max="30" value="10">
      </div>
      <div class="control-group">
        <div class="control-header"><span class="control-label">Damping</span><span class="control-value" id="damping-display">99%</span></div>
        <input type="range" id="damping-slider" min="90" max="100" value="99">
      </div>
      <div class="button-row">
        <button class="btn" onclick="resetSimulation()">Reset</button>
        <button class="btn btn-secondary" id="pause-btn" onclick="togglePause()">Pause</button>
      </div>
    </div>
  </div>

  <script>
    const state = {
      angle: 785, angularVelocity: 0,
      pendulumLength: 200, bobRadius: 20,
      gravity: 10, damping: 99,
      pivotX: 276, pivotY: 50,
      width: 552, height: 350,
      running: true, trail: []
    };

    const canvas = document.getElementById('simulation-canvas');
    const ctx = canvas.getContext('2d');

    function updatePhysics(dt) {
      if (!state.running) return;
      const { angle, angularVelocity, pendulumLength, gravity, damping, pivotX, pivotY } = state;

      const angularAccel = -(gravity / (pendulumLength / 100)) * Math.sin(angle / 1000) * 1000;
      const newAngularVelocity = (angularVelocity + angularAccel * dt) * (damping / 100);
      const newAngle = angle + angularVelocity * dt;
      const bobX = pivotX + pendulumLength * Math.sin(angle / 1000);
      const bobY = pivotY + pendulumLength * Math.cos(angle / 1000);

      state.angle = newAngle;
      state.angularVelocity = newAngularVelocity;
      state.trail = [{ x: bobX, y: bobY, age: 0 }, ...state.trail.map(p => ({ ...p, age: p.age + 1 })).filter(p => p.age < 50)];
    }

    function render() {
      const { angle, pendulumLength, pivotX, pivotY, bobRadius, width, height, trail } = state;
      const bobX = pivotX + pendulumLength * Math.sin(angle / 1000);
      const bobY = pivotY + pendulumLength * Math.cos(angle / 1000);

      const gradient = ctx.createLinearGradient(0, 0, 0, height);
      gradient.addColorStop(0, '#0f0f1a'); gradient.addColorStop(1, '#1a1a2e');
      ctx.fillStyle = gradient; ctx.fillRect(0, 0, width, height);

      trail.forEach(point => {
        const alpha = 1 - point.age / 50;
        ctx.beginPath(); ctx.arc(point.x, point.y, 3, 0, Math.PI * 2);
        ctx.fillStyle = 'rgba(102, 126, 234, ' + (alpha * 0.5) + ')'; ctx.fill();
      });

      ctx.beginPath(); ctx.moveTo(pivotX, pivotY); ctx.lineTo(bobX, bobY);
      ctx.strokeStyle = '#4a5568'; ctx.lineWidth = 3; ctx.stroke();

      ctx.beginPath(); ctx.arc(pivotX, pivotY, 8, 0, Math.PI * 2);
      ctx.fillStyle = '#2d3748'; ctx.fill();
      ctx.strokeStyle = '#4a5568'; ctx.lineWidth = 2; ctx.stroke();

      const bobGradient = ctx.createRadialGradient(bobX - 5, bobY - 5, 0, bobX, bobY, bobRadius);
      bobGradient.addColorStop(0, '#764ba2'); bobGradient.addColorStop(1, '#667eea');
      ctx.beginPath(); ctx.arc(bobX, bobY, bobRadius, 0, Math.PI * 2);
      ctx.fillStyle = bobGradient; ctx.fill();
    }

    function updateDisplays() {}

    document.getElementById('length-slider').addEventListener('input', e => {
      state.pendulumLength = parseFloat(e.target.value);
      document.getElementById('length-display').textContent = e.target.value + 'px';
    });
    document.getElementById('gravity-slider').addEventListener('input', e => {
      state.gravity = parseFloat(e.target.value);
      document.getElementById('gravity-display').textContent = e.target.value;
    });
    document.getElementById('damping-slider').addEventListener('input', e => {
      state.damping = parseFloat(e.target.value);
      document.getElementById('damping-display').textContent = e.target.value + '%';
    });

    function resetSimulation() {
      state.angle = 785; state.angularVelocity = 0;
      state.trail = []; state.running = true;
      document.getElementById('pause-btn').textContent = 'Pause';
    }
    function togglePause() {
      state.running = !state.running;
      document.getElementById('pause-btn').textContent = state.running ? 'Pause' : 'Resume';
    }

    let lastTime = performance.now();
    function animate() {
      const now = performance.now();
      const dt = Math.min((now - lastTime) / 1000, 0.1);
      lastTime = now;
      updatePhysics(dt); render(); updateDisplays();
      requestAnimationFrame(animate);
    }
    animate();
  </script>
</body>
</html>