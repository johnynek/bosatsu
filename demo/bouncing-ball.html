<!DOCTYPE html>
<html lang="en" data-theme="light">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Bouncing ball</title>
  
  <style>
    :root { --bg-color: #f5f5f5; --text-color: #333333; --accent-color: #667eea; --surface-color: #ffffff; }
    * { box-sizing: border-box; }
    body { font-family: system-ui, -apple-system, sans-serif; max-width: 600px; margin: 0 auto; padding: 1rem; background: var(--bg-color); color: var(--text-color); }
    .applet-container { background: var(--surface-color); border-radius: 12px; padding: 1.5rem; box-shadow: 0 4px 20px rgba(0,0,0,0.1); }
    .applet-title { margin: 0 0 0.5rem 0; font-size: 1.5rem; }
    .applet-subtitle { margin: 0 0 1rem 0; font-size: 0.875rem; color: #666; }
    .simulation-canvas { width: 100%; border-radius: 8px; }
    .controls-section { margin-top: 1rem; padding-top: 1rem; border-top: 1px solid rgba(0,0,0,0.1); }
    .control-group { margin: 1rem 0; }
    .control-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.5rem; }
    .control-label { font-size: 0.875rem; font-weight: 500; }
    .control-value { font-family: monospace; font-weight: bold; color: var(--accent-color); }
    input[type="range"] { width: 100%; height: 8px; -webkit-appearance: none; background: #ddd; border-radius: 4px; outline: none; }
    input[type="range"]::-webkit-slider-thumb { -webkit-appearance: none; width: 20px; height: 20px; background: var(--accent-color); border-radius: 50%; cursor: pointer; }
    .button-row { display: flex; gap: 0.5rem; margin-top: 1rem; }
    .btn { padding: 0.5rem 1rem; background: var(--accent-color); color: white; border: none; border-radius: 6px; cursor: pointer; font-size: 0.875rem; }
    .btn:hover { opacity: 0.9; }
    .btn-secondary { background: #6c757d; }
    .stats-row { display: flex; justify-content: space-between; padding: 0.5rem 0; border-bottom: 1px solid #eee; font-size: 0.875rem; }
    .stats-label { color: #666; }
    .stats-value { font-family: monospace; font-weight: 500; }
  </style>
</head>
<body>
  <div class="applet-container">
    <h1 class="applet-title">Bouncing ball</h1>
    <p class="applet-subtitle">Generated from Bosatsu</p>
    <canvas id="simulation-canvas" class="simulation-canvas" width="552" height="300"></canvas>
    <div class="controls-section">
      <div class="control-group">
        <div class="control-header"><span class="control-label">Gravity</span><span class="control-value" id="gravity-display">500</span></div>
        <input type="range" id="gravity-slider" min="0" max="1000" value="500">
      </div>
      <div class="control-group">
        <div class="control-header"><span class="control-label">Bounciness</span><span class="control-value" id="bounciness-display">80%</span></div>
        <input type="range" id="bounciness-slider" min="0" max="100" value="80">
      </div>
      <div class="stats-row"><span class="stats-label">Position:</span><span class="stats-value">(<span id="x-display">200</span>, <span id="y-display">50</span>)</span></div>
      <div class="stats-row"><span class="stats-label">Velocity:</span><span class="stats-value">(<span id="vx-display">100</span>, <span id="vy-display">0</span>)</span></div>
      <div class="button-row">
        <button class="btn" onclick="resetSimulation()">Reset</button>
        <button class="btn btn-secondary" id="pause-btn" onclick="togglePause()">Pause</button>
      </div>
    </div>
  </div>

  <script>
    const state = {
      x: 200, y: 50, vx: 100, vy: 0,
      gravity: 500, bounciness: 80,
      width: 552, height: 300, ballRadius: 20,
      running: true
    };

    const canvas = document.getElementById('simulation-canvas');
    const ctx = canvas.getContext('2d');

    function updatePhysics(dt) {
      if (!state.running) return;
      const { x, y, vx, vy, gravity, bounciness, width, height, ballRadius } = state;

      let newVy = vy + gravity * dt;
      let newY = y + vy * dt;
      let newX = x + vx * dt;
      let newVx = vx;
      const b = bounciness / 100;

      if (y + ballRadius > height) { newY = height - ballRadius; newVy = -Math.abs(newVy) * b; }
      if (y - ballRadius < 0) { newY = ballRadius; newVy = Math.abs(newVy) * b; }
      if (x - ballRadius < 0) { newX = ballRadius; newVx = Math.abs(newVx) * b; }
      if (x + ballRadius > width) { newX = width - ballRadius; newVx = -Math.abs(newVx) * b; }

      state.x = newX; state.y = newY; state.vx = newVx; state.vy = newVy;
    }

    function render() {
      const { x, y, width, height, ballRadius } = state;
      const bgGradient = ctx.createLinearGradient(0, 0, 0, height);
      bgGradient.addColorStop(0, '#1a1a2e'); bgGradient.addColorStop(1, '#16162a');
      ctx.fillStyle = bgGradient; ctx.fillRect(0, 0, width, height);

      ctx.strokeStyle = 'rgba(255,255,255,0.03)'; ctx.lineWidth = 1;
      for (let gx = 0; gx <= width; gx += 40) { ctx.beginPath(); ctx.moveTo(gx, 0); ctx.lineTo(gx, height); ctx.stroke(); }
      for (let gy = 0; gy <= height; gy += 40) { ctx.beginPath(); ctx.moveTo(0, gy); ctx.lineTo(width, gy); ctx.stroke(); }

      ctx.beginPath(); ctx.ellipse(x, height - 5, ballRadius * 0.8, ballRadius * 0.2, 0, 0, Math.PI * 2);
      ctx.fillStyle = 'rgba(0,0,0,0.3)'; ctx.fill();

      const shapeGradient = ctx.createRadialGradient(x - ballRadius * 0.3, y - ballRadius * 0.3, 0, x, y, ballRadius);
      shapeGradient.addColorStop(0, '#ff6b8a'); shapeGradient.addColorStop(1, '#e94560');
      ctx.beginPath(); ctx.arc(x, y, ballRadius, 0, Math.PI * 2); ctx.fillStyle = shapeGradient; ctx.fill();
    }

    function updateDisplays() {
      document.getElementById('x-display').textContent = state.x.toFixed(0);
      document.getElementById('y-display').textContent = state.y.toFixed(0);
      document.getElementById('vx-display').textContent = state.vx.toFixed(0);
      document.getElementById('vy-display').textContent = state.vy.toFixed(0);
    }

    document.getElementById('gravity-slider').addEventListener('input', e => {
      state.gravity = parseInt(e.target.value);
      document.getElementById('gravity-display').textContent = e.target.value;
    });
    document.getElementById('bounciness-slider').addEventListener('input', e => {
      state.bounciness = parseFloat(e.target.value);
      document.getElementById('bounciness-display').textContent = e.target.value + '%';
    });

    function resetSimulation() {
      state.x = 200; state.y = 50; state.vx = 100; state.vy = 0;
      state.running = true; document.getElementById('pause-btn').textContent = 'Pause';
    }
    function togglePause() {
      state.running = !state.running;
      document.getElementById('pause-btn').textContent = state.running ? 'Pause' : 'Resume';
    }

    let lastTime = performance.now();
    function animate() {
      const now = performance.now();
      const dt = Math.min((now - lastTime) / 1000, 0.1);
      lastTime = now;
      updatePhysics(dt); render(); updateDisplays();
      requestAnimationFrame(animate);
    }
    animate();
  </script>
</body>
</html>