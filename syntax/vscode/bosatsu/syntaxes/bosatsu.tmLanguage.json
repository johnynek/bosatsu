{
	"$schema": "https://raw.githubusercontent.com/martinring/tmlanguage/master/tmlanguage.json",
	"name": "bosatsu",
	"patterns": [
		{
			"include": "#keywords"
		},
		{
			"include": "#char_literal"
		},
		{
			"include": "#double_quote_strings"
		},
		{
			"include": "#single_quote_strings"
		},
		{
			"include": "#comment_line"
		},
		{
			"include": "#def_name"
		},
		{
			"include": "#capitalized_identifiers"
		},
		{
			"match": "\\b\\d[\\d_]*\\b",
			"name": "constant.numeric.integer.decimal.bosatsu"
		},
		{ "include": "#struct" },
		{ "include": "#unit_struct" },
		{ "include": "#enum" }
	],
	"repository": {
		"keywords": {
			"patterns": [
				{
					"match": "\\b(for)\\b(?:(?!in).)*\\b(in)",
					"captures": {
						"1": {
					      "name": "keyword.control.repeat.bosatsu"
						},
						"2": {
					      "name": "keyword.control.repeat.bosatsu"
						}
					}
			    },
				{
					"name": "keyword.other.bosatsu",
					"match": "\\b(import|package|from|export)\\b"
			    },
				{
					"comment": "keywords that delimit flow conditionals",
					"name": "keyword.control.conditional.bosatsu",
					"match": "\\b(if|elif|else|match|recur|case|matches)\\b"
				}
		    ]
		},
		"double_quote_strings": {
			"name": "meta.string.quoted.double.bosatsu",
			"begin": "\"",
			"beginCaptures": {
				"0": {
					"name": "string.quoted.double.bosatsu"
				}
			},
			"end": "\"",
			"endCaptures": {
				"0": {
					"name": "string.quoted.double.bosatsu"
				}
			},
			"patterns": [
				{
					"include": "#interpolation"
				},
				{
					"name": "constant.character.escape.bosatsu",
					"match": "\\\\."
				},
				{
					"name": "string.quoted.double.bosatsu",
					"match": "[^\\\\$\\\"]+"
				},
				{
					"name": "string.quoted.double.bosatsu",
					"match": "\\$"
				}
			]
		},
		"single_quote_strings": {
			"name": "meta.string.quoted.single.bosatsu",
			"begin": "'",
			"beginCaptures": {
				"0": {
					"name": "string.quoted.single.bosatsu"
				}
			},
			"end": "'",
			"endCaptures": {
				"0": {
					"name": "string.quoted.single.bosatsu"
				}
			},
			"patterns": [
				{
					"include": "#interpolation"
				},
				{
					"name": "constant.character.escape.bosatsu",
					"match": "\\\\."
				},
				{
					"name": "string.quoted.single.bosatsu",
					"match": "[^\\\\$']+"
				},
				{
					"name": "string.quoted.single.bosatsu",
					"match": "\\$"
				}
			]
		},
		"interpolation": {
			"patterns": [
				{
					"name": "meta.interpolation.string.bosatsu",
					"begin": "\\$\\{",
					"beginCaptures": {
						"0": {
							"name": "punctuation.definition.interpolation.begin.bosatsu"
						}
					},
					"contentName": "source.bosatsu",
					"end": "\\}",
					"endCaptures": {
						"0": {
							"name": "punctuation.definition.interpolation.end.bosatsu"
						}
					},
					"patterns": [
						{
							"include": "$self"
						}
					]
				},
				{
					"name": "meta.interpolation.char.bosatsu",
					"begin": "\\$\\.\\{",
					"beginCaptures": {
						"0": {
							"name": "punctuation.definition.interpolation.begin.bosatsu"
						}
					},
					"contentName": "source.bosatsu",
					"end": "\\}",
					"endCaptures": {
						"0": {
							"name": "punctuation.definition.interpolation.end.bosatsu"
						}
					},
					"patterns": [
						{
							"include": "$self"
						}
					]
				}
			]
		},
		"char_literal": {
			"name": "constant.character.bosatsu",
			"match": "\\.(?:'([^'\\\\\\n]|\\\\.)'|\\\"([^\\\"\\\\\\n]|\\\\.)\\\")"
		},
		"comment_line": {
			"name": "comment.line.number-sign.bosatsu",
			"begin": "#",
			"beginCaptures": {
				"0": {
					"name": "punctuation.definition.comment.bosatsu"
				}
			},
			"end": "$"
		},
		"def_name": {
			"name": "meta.function.bosatsu",
			"begin": "^\\s*\\b(def)\\b",
			"beginCaptures": {
				"1": {
					"name": "storage.type.function.bosatsu"
				}
			},
			"patterns": [
			  {
				"begin": "(?<=def\\b)\\s+(operator)\\s+([^\\s(\\[]+)",
				"beginCaptures": {
					"1": {
						"name": "storage.type.function.bosatsu"
					},
					"2": {
						"name": "entity.name.function.bosatsu"
					}
				},
				"end": "[(\\[]"
			  },
              {
			    "begin": "(?<=def\\b)\\s+(?!operator\\b)([^(\\[]+)",
				"beginCaptures": {
					"1": {
						"name": "entity.name.function.bosatsu"
					}
				},
				"end": "[(\\[]"
			  }
			],
			"end": "(?<=\\))(\\s*->.?*)?(:\\s*)",
			"endCaptures": {
				"2": {
					"name": "punctuation.definition.parameters.begin.bosatsu"
				}
			}
		},
		"capitalized_identifiers": {
			"name": "entity.name.type.bosatsu",
			"match": "\\b[A-Z][A-Za-z0-9_]*\\b"
		},
		"struct": {
			"name": "meta.class.bosatsu",
			"begin": "^\\s*(struct)\\s+([^\\s\\(\\[]*)(\\[[^\\]]*\\])?\\s*\\(",
			"beginCaptures": {
				"1": {
					"name": "storage.type.class.bosatsu"
				},
				"2": {
                    "name": "entity.name.class.bosatsu"
				}
			},
			"end": "\\)\\s*\\n"
		},
		"unit_struct": {
			"name": "meta.class.bosatsu",
			"begin": "^\\s*(struct)\\s+([^\\s\\(\\[]*)(\\[[^\\]]*\\])?[\\t ]*",
			"beginCaptures": {
				"1": {
					"name": "storage.type.class.bosatsu"
				},
				"2": {
                    "name": "entity.name.class.bosatsu"
				}
			},
			"end": "\\n"
		},
		"enum": {
			"name": "meta.class.bosatsu",
			"begin": "^\\s*(enum)\\s+([^\\s:\\[]*)(\\[[^\\]]*\\])?\\s*(?:)",
			"beginCaptures": {
				"1": {
					"name": "storage.type.class.bosatsu"
				},
				"2": {
                    "name": "entity.name.class.bosatsu"
				}
			},
			"end": ":"
		}
	},
	"scopeName": "source.bosatsu"
}
